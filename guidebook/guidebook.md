# 编译技术实验指导书

## 一、绪论（王宇奇+陈茂）

### （一）编译器架构

主要介绍编译器的作用和架构

### （二）实验任务概述

主要介绍本学期实验各个部分完成的任务，以及考核，测评等说明

## 二、总体架构设计

## 二、词法分析  （陈茂 4.25已完成）

### （一）词法分析概述

#### 1. 编译器输入源程序

主要说明编译器输入源程序不带复杂结构，只是线性字符串。

#### 2. 词法分析器的作用

说明词法分析器的作用是从线性字符串解析出单词

### （二）词法分析器实现思路

#### 1. 词法分析器工作过程

主要介绍词法分析器的组成部分，运用实例说明词法分析器是如何工作的。

#### 2. 有限状态自动机

主要介绍有限状态自动机（状态转移图），说明词法分析器的主要原理是有限状态自动机，但不必实现一个繁琐的DFA，在具体实现时如何简化。

#### 3. 注意事项

主要介绍特殊情况如注释，换行符，前缀重叠的处理办法

#### 4. 词法错误

## 二、语法分析（陈茂 4.25已完成）

### （一）语法分析概述

#### 1. 语法树

介绍语法树的结构，并用简单的例子（如表达式树）说明建立语法树的重要性。

#### 2. 语法分析器的作用

主要介绍语法分析器在编译器中的功能作用

### （二）语法分析器实现思路

#### 1. 递归下降

主要介绍递归下降的方法，强调递归的思想。

#### 2. 注意事项

主要介绍左递归文法改写，回溯，FIRST集相交等特殊情况的处理方法。

#### 3. 语法错误

## 三、中间代码生成

### （一）四元式（高远 4.25已完成）

#### 1. 四元式介绍

#### 2. 赋值语句

#### 3. 条件语句

#### 4. 循环语句

#### 5. 函数定义

#### 6. 函数调用

#### 7. 读入和输出

#### 8. 符号表设计 

### （二）llvm（王子懿）

#### 1. 简单介绍（4.25已完成）

##### （1）LLVM是什么

简单介绍LLVM

##### （2）三端设计

简单介绍三端设计，LLVM IR / LLVM IR 转 MIPS整体流程设计，以及前中后三端任务

##### （3）工具介绍

介绍Clang，LLVM安装及使用

##### （4）LLVM IR示例

给出demo示例，详细介绍.ll文件结构，简单介绍三地址码以及llvm常用指令。

#### 2. 主函数与常量表达式（4.25已完成）

##### （1）主函数

main,return,getint,printf

##### （2）常量表达式

加减乘除模正负

##### （3）测试样例

#### 3. 全局变量与局部变量（5.2完成）

##### （1）全局变量

##### （2）局部变量与作用域

##### （3）符号表设计

##### （4）测试样例

#### 4. 函数的定义及调用（5.9完成）

##### （1）函数定义

函数定义，参数，函数内部主体

##### （2）函数调用

包括主函数调用和函数调用/自调用

##### （3）测试样例

#### 5. 条件语句与短路求值（5.9，5.16完成）

##### （1）条件语句

与或

##### （2）短路求值

##### （3）测试样例

#### 6. 条件判断与循环（5.16，5.21完成）

##### （1）条件判断

if/else (或者case/switch)

##### （2）循环

while (或者for)

#### 7. 数组与函数（5.21完成）

##### （1）数组

getelementptr

##### （2）数组修改

数组传参维度变化

##### （3）测试样例


- 4/25 第0，1章
- 5/2 第2章
- 5/9 第3、4章
- 5/16 第4、5章
- 5/21 第5、6章

## 四、目标代码生成

### （一）PCODE（陈茂 5.9完成PCODE编码  5.16完成指导书）

#### 1. PCODE概述

#### （1）栈式机

主要介绍栈式机的工作原理，以及几个重要的寄存器及其作用

#### 2. PCODE内存管理

主要介绍PCODE的栈式内存管理，以及程序调用时的内存分配，内存寻址等。

#### 3. PCODE代码生成

列出主要的几个代码（示例），以及运算、数组、函数调用的翻译思路。

#### 4. PCODE执行程序

介绍栈式机的实现思路

#### 5. 注意事项

主要介绍注意事项

### （二）MIPS（高远）

#### 1. MIPS概述

主要介绍MIPS架构，几个重要寄存器的作用等

#### 2. 内存寄存器管理

寄存器的简单分配

#### 3. MIPS代码生成

分模块，如运算，数组，函数调用来介绍每个部分的翻译思路

## 五、代码优化（王宇奇，申浩佳）

### （一）初识SSA（王宇奇 4.25已完成）

### （二）Mem2reg （王宇奇 4.25已完成）

#### 1. phi insertion

确定插入phi函数的基本块

#### 2. variable renaming

对一个变量多处的命名进行重命名

### （三）Function Inline(函数内联) （王宇奇 5.2完成）

### （四）DCE(死代码删除) （王宇奇 5.9完成）

### （五）GVN&GCM(全局值标号&全局代码移动) （王宇奇 5.16完成）

### （六）后端消除PHI（申浩佳）

### （七）寄存器分配（申浩佳）

#### 1. 指派式寄存器分配

#### 2. 图着色寄存器分配

后端活跃分析，构造，简化，合并，冻结，溢出，选择，重新开始

### （八）除法优化（申浩佳）

### （九）窥孔优化（申浩佳）

### （十）指令选择（申浩佳）

### （十一）基本块合并（申浩佳）



